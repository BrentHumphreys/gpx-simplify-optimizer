function updateLayers(){$(".leaflet-control-switcher").html("");for(var a in window.Layers){var b=window.Layers[a];$(".leaflet-control-switcher").append('<option value="'+b.id+'" '+(window.currentLayer.name==b.name?' selected="selected"':"")+">"+b.name+"</option>")}Object.keys(window.Layers).length>0?$(".leaflet-control-switcher-box").show():$(".leaflet-control-switcher-box").hide()}function clearMap(){for(var a in window.Layers)window.Layers[a].remove();window.Layers={},updateLayers()}window.style1={color:"red",opacity:.7,fillOpacity:.7,weight:5,clickable:!1},window.style2={color:"blue",opacity:1,fillOpacity:1,weight:2,clickable:!1};var LayerOptimizer=function(a){this.id=this.createId(),this.name=a.filename,this.sourceLayer=a.layer,this.size=a.layer.getLayers().length,this.sourceLayerStyle=window.style1,this.sourceLayerData=this.getSourceData(),this.sourceLayerNodes=this.getSourceNodes(),this.tolerance=0,this.simplifiedLayerStyle=window.style2,this.simplifiedLayer=[];for(var b=0;b<this.size;b++)this.simplifiedLayer[b]=L.geoJson(null,{style:this.simplifiedLayerStyle}).addTo(window.map);this.simplifiedLayerNodes=0,this.controller=null};LayerOptimizer.prototype={getSourceData:function(){for(var a=[],b=0;b<this.size;b++)a.push(this.sourceLayer.getLayers()[b].toGeoJSON());return a},getSourceNodes:function(){for(var a=0,b=this.getSourceData(),c=0;c<b.length;c++)a+=b[c].geometry.coordinates.length;return a},choose:function(){this.zoom(),this.createLayerGroup(),this.displayInfos(),$("#slider").slider("setValue",this.tolerance)},optimize:function(a){this.simplifiedLayerNodes=0,this.simplifiedLayerData=this.getSourceData();for(var b=0;b<this.size;b++)this.simplifiedLayer[b].clearLayers(),this.simplifiedLayerData[b].geometry.coordinates=simplifyGeometry(this.simplifiedLayerData[b].geometry.coordinates,a),this.simplifiedLayer[b].addData(this.simplifiedLayerData[b]),this.simplifiedLayerNodes+=this.simplifiedLayerData[b].geometry.coordinates.length;this.tolerance=a},getBounds:function(){return this.sourceLayer.getBounds()},zoom:function(){window.map.fitBounds(this.getBounds())},createLayerGroup:function(){var a={};a[this.name+" ("+$.t("layers.simplified")+")"]=this.simplifiedLayer,a[this.name+" ("+$.t("layers.source")+")"]=this.sourceLayer,this.controller=L.control.layers(null,a),this.controller.addTo(window.map)},displayInfos:function(){var a=$.t("layers.infos.title",{name:this.name}),b=$.t("layers.infos.nodes",{sourcenodes:this.sourceLayerNodes,simplifiednodes:this.simplifiedLayerNodes});$("#filename").html(a),$("#nodes").html(b)},clearInfos:function(){$("#filename").html(""),$("#nodes").html("")},remove:function(){this.removeLayers(),this.removeController(),this.clearInfos()},removeLayers:function(){try{window.map.removeLayer(this.sourceLayer)}catch(a){console.log($.t("layers.error.layer"))}try{window.map.removeLayer(this.simplifiedLayer)}catch(a){console.log($.t("layers.error.layer"))}},removeController:function(){try{void 0!==this.controller._map&&this.controller.removeFrom(window.map)}catch(a){console.log($.t("layers.error.controller"))}},createId:function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return a()+a()+a()+a()}};