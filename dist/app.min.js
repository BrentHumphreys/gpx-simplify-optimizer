!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a("object"==typeof exports?require("jquery"):jQuery)}(function(a){function b(a){return h.raw?a:encodeURIComponent(a)}function c(a){return h.raw?a:decodeURIComponent(a)}function d(a){return b(h.json?JSON.stringify(a):String(a))}function e(a){0===a.indexOf('"')&&(a=a.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return a=decodeURIComponent(a.replace(g," ")),h.json?JSON.parse(a):a}catch(b){}}function f(b,c){var d=h.raw?b:e(b);return a.isFunction(c)?c(d):d}var g=/\+/g,h=a.cookie=function(e,g,i){if(void 0!==g&&!a.isFunction(g)){if(i=a.extend({},h.defaults,i),"number"==typeof i.expires){var j=i.expires,k=i.expires=new Date;k.setTime(+k+864e5*j)}return document.cookie=[b(e),"=",d(g),i.expires?"; expires="+i.expires.toUTCString():"",i.path?"; path="+i.path:"",i.domain?"; domain="+i.domain:"",i.secure?"; secure":""].join("")}for(var l=e?void 0:{},m=document.cookie?document.cookie.split("; "):[],n=0,o=m.length;o>n;n++){var p=m[n].split("="),q=c(p.shift()),r=p.join("=");if(e&&e===q){l=f(r,g);break}e||void 0===(r=f(r))||(l[q]=r)}return l};h.defaults={},a.removeCookie=function(b,c){return void 0===a.cookie(b)?!1:(a.cookie(b,"",a.extend({},c,{expires:-1})),!a.cookie(b))}});;
L.Control.Sidebar=L.Control.extend({includes:L.Mixin.Events,options:{closeButton:!0,position:"left",autoPan:!0},initialize:function(a,b){L.setOptions(this,b);var c=this._contentContainer=L.DomUtil.get(a);c.parentNode.removeChild(c);var d="leaflet-",e=this._container=L.DomUtil.create("div",d+"sidebar "+this.options.position);if(L.DomUtil.addClass(c,d+"control"),e.appendChild(c),this.options.closeButton){var f=this._closeButton=L.DomUtil.create("a","close",e);f.innerHTML="&times;"}},addTo:function(a){var b=this._container,c=this._contentContainer;if(this.options.closeButton){var d=this._closeButton;L.DomEvent.on(d,"click",this.hide,this)}L.DomEvent.on(b,"transitionend",this._handleTransitionEvent,this).on(b,"webkitTransitionEnd",this._handleTransitionEvent,this);var e=a._controlContainer;e.insertBefore(b,e.firstChild),this._map=a;var f=L.DomEvent.stopPropagation;return L.DomEvent.on(c,"click",f).on(c,"mousedown",f).on(c,"touchstart",f).on(c,"dblclick",f).on(c,"mousewheel",f).on(c,"MozMousePixelScroll",f),this},removeFrom:function(a){this.hide();var b=this._contentContainer,c=a._controlContainer;c.removeChild(this._container),this._map=null;var d=L.DomEvent.stopPropagation;if(L.DomEvent.off(b,"click",d).off(b,"mousedown",d).off(b,"touchstart",d).off(b,"dblclick",d).off(b,"mousewheel",d).off(b,"MozMousePixelScroll",d),L.DomEvent.off(container,"transitionend",this._handleTransitionEvent,this).off(container,"webkitTransitionEnd",this._handleTransitionEvent,this),this._closeButton&&this._close){var e=this._closeButton;L.DomEvent.off(e,"click",this.hide,this)}return this},isVisible:function(){return L.DomUtil.hasClass(this._container,"visible")},show:function(){this.isVisible()||(L.DomUtil.addClass(this._container,"visible"),this.options.autoPan&&this._map.panBy([-this.getOffset()/2,0],{duration:.5}),this.fire("show"))},hide:function(a){this.isVisible()&&(L.DomUtil.removeClass(this._container,"visible"),this.options.autoPan&&this._map.panBy([this.getOffset()/2,0],{duration:.5}),this.fire("hide")),a&&L.DomEvent.stopPropagation(a)},toggle:function(){this.isVisible()?this.hide():this.show()},getContainer:function(){return this._contentContainer},getCloseButton:function(){return this._closeButton},setContent:function(a){return this.getContainer().innerHTML=a,this},getOffset:function(){return"right"===this.options.position?-this._container.offsetWidth:this._container.offsetWidth},_handleTransitionEvent:function(a){("left"==a.propertyName||"right"==a.propertyName)&&this.fire(this.isVisible()?"shown":"hidden")}}),L.control.sidebar=function(a,b){return new L.Control.Sidebar(a,b)};;
toGeoJSON=function(){"use strict";function a(a){if(!a||!a.length)return 0;for(var b=0,c=0;b<a.length;b++)c=(c<<5)-c+a.charCodeAt(b)|0;return c}function b(a,b){return a.getElementsByTagName(b)}function c(a,b){return a.getAttribute(b)}function d(a,b){return parseFloat(c(a,b))}function e(a,c){var d=b(a,c);return d.length?d[0]:null}function f(a){return a.normalize&&a.normalize(),a}function g(a){for(var b=0,c=[];b<a.length;b++)c[b]=parseFloat(a[b]);return c}function h(a){var b={};for(var c in a)a[c]&&(b[c]=a[c]);return b}function i(a){return a&&f(a),a&&a.firstChild&&a.firstChild.nodeValue||""}function j(a){return g(a.replace(p,"").split(","))}function k(a){for(var b=a.replace(q,"").split(r),c=[],d=0;d<b.length;d++)c.push(j(b[d]));return c}function l(a){var b=[d(a,"lon"),d(a,"lat")],c=e(a,"ele");return c&&b.push(parseFloat(i(c))),b}function m(){return{type:"FeatureCollection",features:[]}}function n(a){return o.serializeToString(a)}var o,p=/\s*/g,q=/^\s*|\s*$/g,r=/\s+/;"undefined"!=typeof XMLSerializer?o=new XMLSerializer:"object"!=typeof exports||"object"!=typeof process||process.browser||(o=new(require("xmldom").XMLSerializer));var s={kml:function(d,f){function h(a){var b,c;return a=a||"","#"===a.substr(0,1)&&(a=a.substr(1)),(6===a.length||3===a.length)&&(b=a),8===a.length&&(c=parseInt(a.substr(0,2),16)/255,b=a.substr(2)),[b,isNaN(c)?void 0:c]}function l(a){return g(a.split(" "))}function o(a){for(var c=b(a,"coord","gx"),d=[],e=0;e<c.length;e++)d.push(l(i(c[e])));return d}function p(a){var c,d,f,g,h,l=[];if(e(a,"MultiGeometry"))return p(e(a,"MultiGeometry"));if(e(a,"MultiTrack"))return p(e(a,"MultiTrack"));for(f=0;f<t.length;f++)if(d=b(a,t[f]))for(g=0;g<d.length;g++)if(c=d[g],"Point"==t[f])l.push({type:"Point",coordinates:j(i(e(c,"coordinates")))});else if("LineString"==t[f])l.push({type:"LineString",coordinates:k(i(e(c,"coordinates")))});else if("Polygon"==t[f]){var m=b(c,"LinearRing"),n=[];for(h=0;h<m.length;h++)n.push(k(i(e(m[h],"coordinates"))));l.push({type:"Polygon",coordinates:n})}else"Track"==t[f]&&l.push({type:"LineString",coordinates:o(c)});return l}function q(a){var c,d=p(a),f={},g=i(e(a,"name")),j=i(e(a,"styleUrl")),k=i(e(a,"description")),l=e(a,"TimeSpan"),m=e(a,"ExtendedData"),n=e(a,"LineStyle"),o=e(a,"PolyStyle");if(!d.length)return[];if(g&&(f.name=g),j&&s[j]&&(f.styleUrl=j,f.styleHash=s[j]),k&&(f.description=k),l){var q=i(e(l,"begin")),r=i(e(l,"end"));f.timespan={begin:q,end:r}}if(n){var t=h(i(e(n,"color"))),u=t[0],v=t[1],w=parseFloat(i(e(n,"width")));u&&(f.stroke=u),isNaN(v)||(f["stroke-opacity"]=v),isNaN(w)||(f["stroke-width"]=w)}if(o){var x=h(i(e(o,"color"))),y=x[0],z=x[1],A=i(e(o,"fill")),B=i(e(o,"outline"));y&&(f.fill=y),isNaN(z)||(f["fill-opacity"]=z),A&&(f["fill-opacity"]="1"===A?1:0),B&&(f["stroke-opacity"]="1"===B?1:0)}if(m){var C=b(m,"Data"),D=b(m,"SimpleData");for(c=0;c<C.length;c++)f[C[c].getAttribute("name")]=i(e(C[c],"value"));for(c=0;c<D.length;c++)f[D[c].getAttribute("name")]=i(D[c])}return[{type:"Feature",geometry:1===d.length?d[0]:{type:"GeometryCollection",geometries:d},properties:f}]}f=f||{};for(var r=m(),s={},t=["Polygon","LineString","Point","Track"],u=b(d,"Placemark"),v=b(d,"Style"),w=0;w<v.length;w++)s["#"+c(v[w],"id")]=a(n(v[w])).toString(16);for(var x=0;x<u.length;x++)r.features=r.features.concat(q(u[x]));return r},gpx:function(a){function c(a,c){for(var d=b(a,c),e=[],f=0;f<d.length;f++)e.push(l(d[f]));return e}function d(a){for(var d=b(a,"trkseg"),e=[],f=0;f<d.length;f++)e.push(c(d[f],"trkpt"));return{type:"Feature",properties:j(a),geometry:{type:1===e.length?"LineString":"MultiLineString",coordinates:1===e.length?e[0]:e}}}function f(a){return{type:"Feature",properties:j(a),geometry:{type:"LineString",coordinates:c(a,"rtept")}}}function g(a){var b=j(a);return b.sym=i(e(a,"sym")),{type:"Feature",properties:b,geometry:{type:"Point",coordinates:l(a)}}}function j(a){var b,c=["name","desc","author","copyright","link","time","keywords"],d={};for(b=0;b<c.length;b++)d[c[b]]=i(e(a,c[b]));return h(d)}var k,n=b(a,"trk"),o=b(a,"rte"),p=b(a,"wpt"),q=m();for(k=0;k<n.length;k++)q.features.push(d(n[k]));for(k=0;k<o.length;k++)q.features.push(f(o[k]));for(k=0;k<p.length;k++)q.features.push(g(p[k]));return q}};return s}(),"undefined"!=typeof module&&(module.exports=toGeoJSON);;
!function(a){"object"==typeof exports?module.exports=a():"function"==typeof define&&define.amd?define(a):"undefined"!=typeof window?window.togpx=a():"undefined"!=typeof global?global.togpx=a():"undefined"!=typeof self&&(self.togpx=a())}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){function c(a,b){function c(a){if("object"==typeof a.tags){var b=c(a.tags);if(""!==b)return b}return a.name?a.name:a.ref?a.ref:a.id?a.id:""}function e(a){if("object"==typeof a.tags)return e(a.tags);var b="";for(var c in a)"object"!=typeof a[c]&&(b+=c+"="+a[c]+"\n");return b.substr(0,b.length-1)}function f(a,c){b.featureLink&&(a.link={"@href":b.featureLink(c.properties)})}b=function(a,b){for(var c in a)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}({creator:"togpx",metadata:void 0,featureTitle:c,featureDescription:e,featureLink:void 0},b||{});var g={gpx:{"@xmlns":"http://www.topografix.com/GPX/1/1","@xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance","@xsi:schemaLocation":"http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd","@version":"1.1",wpt:[],trk:[]}};b.creator&&(g.gpx["@creator"]=b.creator),b.metadata&&(g.gpx.metadata=b.metadata);var h;return h="FeatureCollection"===a.type?a.features:"Feature"===a.type?[a]:[{type:"Feature",properties:{},geometry:a}],h.forEach(function i(a){switch(a.geometry.type){case"Point":case"MultiPoint":var c=a.geometry.coordinates;"Point"==a.geometry.type&&(c=[c]),c.forEach(function(c){o={"@lat":c[1],"@lon":c[0],name:b.featureTitle(a.properties),desc:b.featureDescription(a.properties)},f(o,a),g.gpx.wpt.push(o)});break;case"LineString":case"MultiLineString":var c=a.geometry.coordinates;"LineString"==a.geometry.type&&(c=[c]),o={name:b.featureTitle(a.properties),desc:b.featureDescription(a.properties)},f(o,a),o.trkseg=[],c.forEach(function(a){var b={trkpt:[]};a.forEach(function(a){b.trkpt.push({"@lat":a[1],"@lon":a[0]})}),o.trkseg.push(b)}),g.gpx.trk.push(o);break;case"Polygon":case"MultiPolygon":o={name:b.featureTitle(a.properties),desc:b.featureDescription(a.properties)},f(o,a),o.trkseg=[];var c=a.geometry.coordinates;"Polygon"==a.geometry.type&&(c=[c]),c.forEach(function(a){a.forEach(function(a){var b={trkpt:[]};a.forEach(function(a){b.trkpt.push({"@lat":a[1],"@lon":a[0]})}),o.trkseg.push(b)})}),g.gpx.trk.push(o);break;case"GeometryCollection":a.geometry.geometries.forEach(function(b){var c={properties:a.properties,geometry:b};i(c)});break;default:console.log("warning: unsupported geometry type: "+a.geometry.type)}}),gpx_str=d.stringify(g)}var d=a("jxon");b.exports=c},{jxon:2}],2:[function(a,b){"undefined"==typeof XMLSerializer&&(XMLSerializer=a("xmldom").XMLSerializer,document={},document.implementation=new(a("xmldom").DOMImplementation));var c=new function(){function a(a){return k.test(a)?null:l.test(a)?"true"===a.toLowerCase():isFinite(a)?parseFloat(a):isFinite(Date.parse(a))?new Date(a):a}function b(){}function d(a){return null===a?new b:a instanceof Object?a:new a.constructor(a)}function e(b,c,f,k){var l,m,n=j.length,o=b.hasChildNodes(),p=b.hasAttributes(),q=Boolean(2&c),r=0,s="",t=q?{}:!0;if(o)for(var u,v=0;v<b.childNodes.length;v++)u=b.childNodes.item(v),4===u.nodeType?s+=u.nodeValue:3===u.nodeType?s+=u.nodeValue.trim():1!==u.nodeType||u.prefix||j.push(u);var w=j.length,x=a(s);q||!o&&!p||(t=0===c?d(x):{});for(var y=n;w>y;y++)l=j[y].nodeName.toLowerCase(),m=e(j[y],c,f,k),t.hasOwnProperty(l)?(t[l].constructor!==Array&&(t[l]=[t[l]]),t[l].push(m)):(t[l]=m,r++);if(p){for(var z,A=b.attributes.length,B=k?"":i,C=k?{}:t,D=0;A>D;r++,D++)z=b.attributes.item(D),C[B+z.name.toLowerCase()]=a(z.value.trim());k&&(f&&Object.freeze(C),t[h]=C,r-=A-1)}return 3===c||(2===c||1===c&&r>0)&&s?t[g]=x:!q&&0===r&&s&&(t=x),f&&(q||r>0)&&Object.freeze(t),j.length=n,t}function f(a,b,c){var d,e;c instanceof String||c instanceof Number||c instanceof Boolean?b.appendChild(a.createTextNode(c.toString())):c.constructor===Date&&b.appendChild(a.createTextNode(c.toGMTString()));for(var j in c)if(d=c[j],!(isFinite(j)||d instanceof Function))if(j===g)null!==d&&d!==!0&&b.appendChild(a.createTextNode(d.constructor===Date?d.toGMTString():String(d)));else if(j===h)for(var k in d)b.setAttribute(k,d[k]);else if(j.charAt(0)===i)b.setAttribute(j.slice(1),d);else if(d.constructor===Array)for(var l=0;l<d.length;l++)e=a.createElement(j),f(a,e,d[l]),b.appendChild(e);else e=a.createElement(j),d instanceof Object?f(a,e,d):null!==d&&d!==!0&&e.appendChild(a.createTextNode(d.toString())),b.appendChild(e)}var g="keyValue",h="keyAttributes",i="@",j=[],k=/^\s*$/,l=/^(?:true|false)$/i;b.prototype.toString=function(){return"null"},b.prototype.valueOf=function(){return null},this.build=function(a,b,c,d){var f=arguments.length>1&&"number"==typeof b?3&b:1;return e(a,f,c||!1,arguments.length>3?d:3===f)},this.unbuild=function(a){var b=document.implementation.createDocument("","",null);return f(b,b,a),b},this.stringify=function(a){return(new XMLSerializer).serializeToString(c.unbuild(a))}};b.exports=c},{xmldom:3}],3:[function(){},{}]},{},[1])(1)});;
var FileLoader=L.Class.extend({includes:L.Mixin.Events,options:{layerOptions:{},fileSizeLimit:1024},initialize:function(a,b){this._map=a,L.Util.setOptions(this,b),this._parsers={geojson:this._loadGeoJSON,gpx:this._convertToGeoJSON,kml:this._convertToGeoJSON}},load:function(a){var b=(a.size/1024).toFixed(4);if(b>this.options.fileSizeLimit)return void this.fire("data:error",{error:new Error("File size exceeds limit ("+b+" > "+this.options.fileSizeLimit+"kb)")});var c=a.name.split(".").pop(),d=this._parsers[c];if(!d)return void this.fire("data:error",{error:new Error("Unsupported file type "+a.type+"("+c+")")});var e=new FileReader;return e.onload=L.Util.bind(function(b){try{this.fire("data:loading",{filename:a.name,format:c});var e=d.call(this,b.target.result,c);this.fire("data:loaded",{layer:e,filename:a.name,format:c})}catch(f){this.fire("data:error",{error:f})}},this),e.readAsText(a),e},_loadGeoJSON:function(a){"string"==typeof a&&(a=JSON.parse(a));var b=L.geoJson(a,this.options.layerOptions);if(0===b.getLayers().length)throw new Error("GeoJSON has no valid layers.");return this.options.addToMap&&b.addTo(this._map),b},_convertToGeoJSON:function(a,b){"string"==typeof a&&(a=(new window.DOMParser).parseFromString(a,"text/xml"));var c=toGeoJSON[b](a);return this._loadGeoJSON(c)}});L.Control.FileLayerLoad=L.Control.extend({statics:{TITLE:"Load local file (GPX, KML, GeoJSON)",LABEL:"&#8965;"},options:{position:"topleft",fitBounds:!0,layerOptions:{},addToMap:!0,fileSizeLimit:1024},initialize:function(a){L.Util.setOptions(this,a),this.loader=null},onAdd:function(a){return this.loader=new FileLoader(a,this.options),this.loader.on("data:loaded",function(b){this.options.fitBounds&&window.setTimeout(function(){a.fitBounds(b.layer.getBounds())},500)},this),this._initDragAndDrop(a),this._initContainer()},_initDragAndDrop:function(a){var b=this.loader,c=a._container,d={dragenter:function(){a.scrollWheelZoom.disable()},dragleave:function(){a.scrollWheelZoom.enable()},dragover:function(a){a.stopPropagation(),a.preventDefault()},drop:function(c){c.stopPropagation(),c.preventDefault();{var d=Array.prototype.slice.apply(c.dataTransfer.files);d.length}setTimeout(function(){b.load(d.shift()),d.length>0&&setTimeout(arguments.callee,25)},25),a.scrollWheelZoom.enable()}};for(var e in d)c.addEventListener(e,d[e],!1)},_initContainer:function(){var a="leaflet-control-filelayer leaflet-control-zoom",b="leaflet-bar",c=b+"-part",d=L.DomUtil.create("div",a+" "+b),e=L.DomUtil.create("a",a+"-in "+c,d);e.innerHTML=L.Control.FileLayerLoad.LABEL,e.href="#",e.title=L.Control.FileLayerLoad.TITLE;var f=L.DomUtil.create("input","hidden",d);f.type="file",f.accept=".gpx,.kml,.geojson",f.style.display="none";var g=this.loader;return f.addEventListener("change",function(){g.load(this.files[0]),this.value=""},!1),L.DomEvent.disableClickPropagation(e),L.DomEvent.on(e,"click",function(a){f.click(),a.preventDefault()}),d}}),L.Control.fileLayerLoad=function(a){return new L.Control.FileLayerLoad(a)};;
var saveAs=saveAs||"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(a){"use strict";if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var b=a.document,c=function(){return a.URL||a.webkitURL||a},d=a.URL||a.webkitURL||a,e=b.createElementNS("http://www.w3.org/1999/xhtml","a"),f=!a.externalHost&&"download"in e,g=a.webkitRequestFileSystem,h=a.requestFileSystem||g||a.mozRequestFileSystem,i=function(b){(a.setImmediate||a.setTimeout)(function(){throw b},0)},j="application/octet-stream",k=0,l=[],m=function(){for(var a=l.length;a--;){var b=l[a];"string"==typeof b?d.revokeObjectURL(b):b.remove()}l.length=0},n=function(a,b,c){b=[].concat(b);for(var d=b.length;d--;){var e=a["on"+b[d]];if("function"==typeof e)try{e.call(a,c||a)}catch(f){i(f)}}},o=function(d,i){var m,o,p,q=this,r=d.type,s=!1,t=function(){var a=c().createObjectURL(d);return l.push(a),a},u=function(){n(q,"writestart progress write writeend".split(" "))},v=function(){(s||!m)&&(m=t(d)),o?o.location.href=m:window.open(m,"_blank"),q.readyState=q.DONE,u()},w=function(a){return function(){return q.readyState!==q.DONE?a.apply(this,arguments):void 0}},x={create:!0,exclusive:!1};if(q.readyState=q.INIT,i||(i="download"),f){m=t(d),b=a.document,e=b.createElementNS("http://www.w3.org/1999/xhtml","a"),e.href=m,e.download=i;var y=b.createEvent("MouseEvents");return y.initMouseEvent("click",!0,!1,a,0,0,0,0,0,!1,!1,!1,!1,0,null),e.dispatchEvent(y),q.readyState=q.DONE,void u()}return a.chrome&&r&&r!==j&&(p=d.slice||d.webkitSlice,d=p.call(d,0,d.size,j),s=!0),g&&"download"!==i&&(i+=".download"),(r===j||g)&&(o=a),h?(k+=d.size,void h(a.TEMPORARY,k,w(function(a){a.root.getDirectory("saved",x,w(function(a){var b=function(){a.getFile(i,x,w(function(a){a.createWriter(w(function(b){b.onwriteend=function(b){o.location.href=a.toURL(),l.push(a),q.readyState=q.DONE,n(q,"writeend",b)},b.onerror=function(){var a=b.error;a.code!==a.ABORT_ERR&&v()},"writestart progress write abort".split(" ").forEach(function(a){b["on"+a]=q["on"+a]}),b.write(d),q.abort=function(){b.abort(),q.readyState=q.DONE},q.readyState=q.WRITING}),v)}),v)};a.getFile(i,{create:!1},w(function(a){a.remove(),b()}),w(function(a){a.code===a.NOT_FOUND_ERR?b():v()}))}),v)}),v)):void v()},p=o.prototype,q=function(a,b){return new o(a,b)};return p.abort=function(){var a=this;a.readyState=a.DONE,n(a,"abort")},p.readyState=p.INIT=0,p.WRITING=1,p.DONE=2,p.error=p.onwritestart=p.onprogress=p.onwrite=p.onabort=p.onerror=p.onwriteend=null,a.addEventListener("unload",m,!1),q.unload=function(){m(),a.removeEventListener("unload",m,!1)},q}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof module&&null!==module?module.exports=saveAs:"undefined"!=typeof define&&null!==define&&null!=define.amd&&define([],function(){return saveAs});;
!function(e){if("function"==typeof bootstrap)bootstrap("simplifygeometry",e);else if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeSimplifyGeometry=e}else"undefined"!=typeof window?window.simplifyGeometry=e():global.simplifyGeometry=e()}(function(){return function(e,t,n){function i(n,s){if(!t[n]){if(!e[n]){var o="function"==typeof require&&require;if(!s&&o)return o(n,!0);if(r)return r(n,!0);throw new Error("Cannot find module '"+n+"'")}var u=t[n]={exports:{}};e[n][0].call(u.exports,function(t){var r=e[n][1][t];return i(r?r:t)},u,u.exports)}return t[n].exports}for(var r="function"==typeof require&&require,s=0;s<n.length;s++)i(n[s]);return i}({1:[function(require,module){var Line=require("./line"),simplifyGeometry=function(points,tolerance){for(var dmax=0,index=0,i=1;i<=points.length-2;i++)d=new Line(points[0],points[points.length-1]).perpendicularDistance(points[i]),d>dmax&&(index=i,dmax=d);if(dmax>tolerance)var results_one=simplifyGeometry(points.slice(0,index),tolerance),results_two=simplifyGeometry(points.slice(index,points.length),tolerance),results=results_one.concat(results_two);else results=points.length>1?[points[0],points[points.length-1]]:[points[0]];return results};module.exports=simplifyGeometry},{"./line":2}],2:[function(require,module){var Line=function(p1,p2){this.p1=p1,this.p2=p2};Line.prototype.rise=function(){return this.p2[1]-this.p1[1]},Line.prototype.run=function(){return this.p2[0]-this.p1[0]},Line.prototype.slope=function(){return this.rise()/this.run()},Line.prototype.yIntercept=function(){return this.p1[1]-this.p1[0]*this.slope(this.p1,this.p2)},Line.prototype.isVertical=function(){return!isFinite(this.slope())},Line.prototype.isHorizontal=function(){return this.p1[1]==this.p2[1]},Line.prototype._perpendicularDistanceHorizontal=function(point){return Math.abs(this.p1[1]-point[1])},Line.prototype._perpendicularDistanceVertical=function(point){return Math.abs(this.p1[0]-point[0])},Line.prototype._perpendicularDistanceHasSlope=function(point){var slope=this.slope(),y_intercept=this.yIntercept();return Math.abs(slope*point[0]-point[1]+y_intercept)/Math.sqrt(Math.pow(slope,2)+1)},Line.prototype.perpendicularDistance=function(point){return this.isVertical()?this._perpendicularDistanceVertical(point):this.isHorizontal()?this._perpendicularDistanceHorizontal(point):this._perpendicularDistanceHasSlope(point)},module.exports=Line},{}]},{},[1])(1)});;
!function(a){function b(b,d){if(g[b]){var e=c(this),f=g[b].apply(e,d);return"undefined"==typeof f?a(this):f}throw new Error("method '"+b+"()' does not exist for slider.")}function c(b){var c=a(b).data("slider");if(c&&c instanceof f)return c;throw new Error(e.callingContextNotSliderInstance)}function d(b){var c=a(this);return c.each(function(){var c=a(this),d=c.data("slider"),e="object"==typeof b&&b;d&&!e&&(e={},a.each(a.fn.slider.defaults,function(a){e[a]=d[a]})),c.data("slider",new f(this,a.extend({},a.fn.slider.defaults,e)))}),c}var e={formatInvalidInputErrorMsg:function(a){return"Invalid input value '"+a+"' passed in"},callingContextNotSliderInstance:"Calling context element does not have instance of Slider bound to it. Check your code to make sure the JQuery object returned from the call to the slider() initializer is calling the method"},f=function(b,c){var d=this.element=a(b).hide(),e=a(b)[0].style.width,f=!1,g=this.element.parent();g.hasClass("slider")===!0?(f=!0,this.picker=g):this.picker=a('<div class="slider"><div class="slider-track"><div class="slider-selection"></div><div class="slider-handle"></div><div class="slider-handle"></div></div><div id="tooltip" class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div><div id="tooltip_min" class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div><div id="tooltip_max" class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div></div>').insertBefore(this.element).append(this.element),this.id=this.element.data("slider-id")||c.id,this.id&&(this.picker[0].id=this.id),("ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch)&&(this.touchCapable=!0);var h=this.element.data("slider-tooltip")||c.tooltip;switch(this.tooltip=this.picker.find("#tooltip"),this.tooltipInner=this.tooltip.find("div.tooltip-inner"),this.tooltip_min=this.picker.find("#tooltip_min"),this.tooltipInner_min=this.tooltip_min.find("div.tooltip-inner"),this.tooltip_max=this.picker.find("#tooltip_max"),this.tooltipInner_max=this.tooltip_max.find("div.tooltip-inner"),f===!0&&(this.picker.removeClass("slider-horizontal"),this.picker.removeClass("slider-vertical"),this.tooltip.removeClass("hide"),this.tooltip_min.removeClass("hide"),this.tooltip_max.removeClass("hide")),this.orientation=this.element.data("slider-orientation")||c.orientation,this.orientation){case"vertical":this.picker.addClass("slider-vertical"),this.stylePos="top",this.mousePos="pageY",this.sizePos="offsetHeight",this.tooltip.addClass("right")[0].style.left="100%",this.tooltip_min.addClass("right")[0].style.left="100%",this.tooltip_max.addClass("right")[0].style.left="100%";break;default:this.picker.addClass("slider-horizontal").css("width",e),this.orientation="horizontal",this.stylePos="left",this.mousePos="pageX",this.sizePos="offsetWidth",this.tooltip.addClass("top")[0].style.top=-this.tooltip.outerHeight()-14+"px",this.tooltip_min.addClass("top")[0].style.top=-this.tooltip_min.outerHeight()-14+"px",this.tooltip_max.addClass("top")[0].style.top=-this.tooltip_max.outerHeight()-14+"px"}var i=this;switch(a.each(["min","max","step","precision","value","reversed","handle"],function(a,b){i[b]="undefined"!=typeof d.data("slider-"+b)?d.data("slider-"+b):"undefined"!=typeof c[b]?c[b]:"undefined"!=typeof d.prop(b)?d.prop(b):0}),this.value instanceof Array?f&&!this.range?this.value=this.value[0]:this.range=!0:this.range&&(this.value=[this.value,this.max]),this.selection=this.element.data("slider-selection")||c.selection,this.selectionEl=this.picker.find(".slider-selection"),"none"===this.selection&&this.selectionEl.addClass("hide"),this.selectionElStyle=this.selectionEl[0].style,this.handle1=this.picker.find(".slider-handle:first"),this.handle1Stype=this.handle1[0].style,this.handle2=this.picker.find(".slider-handle:last"),this.handle2Stype=this.handle2[0].style,f===!0&&(this.handle1.removeClass("round triangle"),this.handle2.removeClass("round triangle hide")),this.handle){case"round":this.handle1.addClass("round"),this.handle2.addClass("round");break;case"triangle":this.handle1.addClass("triangle"),this.handle2.addClass("triangle")}this.offset=this.picker.offset(),this.size=this.picker[0][this.sizePos],this.formater=c.formater,this.tooltip_separator=c.tooltip_separator,this.tooltip_split=c.tooltip_split,this.setValue(this.value),this.handle1.on({keydown:a.proxy(this.keydown,this,0)}),this.handle2.on({keydown:a.proxy(this.keydown,this,1)}),this.touchCapable&&this.picker.on({touchstart:a.proxy(this.mousedown,this)}),this.picker.on({mousedown:a.proxy(this.mousedown,this)}),"hide"===h?(this.tooltip.addClass("hide"),this.tooltip_min.addClass("hide"),this.tooltip_max.addClass("hide")):"always"===h?(this.showTooltip(),this.alwaysShowTooltip=!0):(this.picker.on({mouseenter:a.proxy(this.showTooltip,this),mouseleave:a.proxy(this.hideTooltip,this)}),this.handle1.on({focus:a.proxy(this.showTooltip,this),blur:a.proxy(this.hideTooltip,this)}),this.handle2.on({focus:a.proxy(this.showTooltip,this),blur:a.proxy(this.hideTooltip,this)})),this.enabled=c.enabled&&(void 0===this.element.data("slider-enabled")||this.element.data("slider-enabled")===!0),this.enabled?this.enable():this.disable(),this.natural_arrow_keys=this.element.data("slider-natural_arrow_keys")||c.natural_arrow_keys};f.prototype={constructor:f,over:!1,inDrag:!1,showTooltip:function(){this.tooltip_split===!1?this.tooltip.addClass("in"):(this.tooltip_min.addClass("in"),this.tooltip_max.addClass("in")),this.over=!0},hideTooltip:function(){this.inDrag===!1&&this.alwaysShowTooltip!==!0&&(this.tooltip.removeClass("in"),this.tooltip_min.removeClass("in"),this.tooltip_max.removeClass("in")),this.over=!1},layout:function(){var a;if(a=this.reversed?[100-this.percentage[0],this.percentage[1]]:[this.percentage[0],this.percentage[1]],this.handle1Stype[this.stylePos]=a[0]+"%",this.handle2Stype[this.stylePos]=a[1]+"%","vertical"===this.orientation)this.selectionElStyle.top=Math.min(a[0],a[1])+"%",this.selectionElStyle.height=Math.abs(a[0]-a[1])+"%";else{this.selectionElStyle.left=Math.min(a[0],a[1])+"%",this.selectionElStyle.width=Math.abs(a[0]-a[1])+"%";var b=this.tooltip_min[0].getBoundingClientRect(),c=this.tooltip_max[0].getBoundingClientRect();b.right>c.left?(this.tooltip_max.removeClass("top"),this.tooltip_max.addClass("bottom")[0].style.top="18px"):(this.tooltip_max.removeClass("bottom"),this.tooltip_max.addClass("top")[0].style.top="-30px")}this.range?(this.tooltipInner.text(this.formater(this.value[0])+this.tooltip_separator+this.formater(this.value[1])),this.tooltip[0].style[this.stylePos]=this.size*(a[0]+(a[1]-a[0])/2)/100-("vertical"===this.orientation?this.tooltip.outerHeight()/2:this.tooltip.outerWidth()/2)+"px",this.tooltipInner_min.text(this.formater(this.value[0])),this.tooltipInner_max.text(this.formater(this.value[1])),this.tooltip_min[0].style[this.stylePos]=this.size*(a[0]/100)-("vertical"===this.orientation?this.tooltip_min.outerHeight()/2:this.tooltip_min.outerWidth()/2)+"px",this.tooltip_max[0].style[this.stylePos]=this.size*(a[1]/100)-("vertical"===this.orientation?this.tooltip_max.outerHeight()/2:this.tooltip_max.outerWidth()/2)+"px"):(this.tooltipInner.text(this.formater(this.value[0])),this.tooltip[0].style[this.stylePos]=this.size*a[0]/100-("vertical"===this.orientation?this.tooltip.outerHeight()/2:this.tooltip.outerWidth()/2)+"px")},mousedown:function(b){if(!this.isEnabled())return!1;this.touchCapable&&"touchstart"===b.type&&(b=b.originalEvent),this.triggerFocusOnHandle(),this.offset=this.picker.offset(),this.size=this.picker[0][this.sizePos];var c=this.getPercentage(b);if(this.range){var d=Math.abs(this.percentage[0]-c),e=Math.abs(this.percentage[1]-c);this.dragged=e>d?0:1}else this.dragged=0;this.percentage[this.dragged]=this.reversed?100-c:c,this.layout(),this.touchCapable&&a(document).on({touchmove:a.proxy(this.mousemove,this),touchend:a.proxy(this.mouseup,this)}),a(document).on({mousemove:a.proxy(this.mousemove,this),mouseup:a.proxy(this.mouseup,this)}),this.inDrag=!0;var f=this.calculateValue();return this.element.trigger({type:"slideStart",value:f}).data("value",f).prop("value",f),this.setValue(f),!0},triggerFocusOnHandle:function(a){0===a&&this.handle1.focus(),1===a&&this.handle2.focus()},keydown:function(a,b){if(!this.isEnabled())return!1;var c;switch(b.which){case 37:case 40:c=-1;break;case 39:case 38:c=1}if(c){this.natural_arrow_keys&&("vertical"===this.orientation&&!this.reversed||"horizontal"===this.orientation&&this.reversed)&&(c=-1*c);var d=c*this.percentage[2],e=this.percentage[a]+d;e>100?e=100:0>e&&(e=0),this.dragged=a,this.adjustPercentageForRangeSliders(e),this.percentage[this.dragged]=e,this.layout();var f=this.calculateValue();return this.element.trigger({type:"slideStart",value:f}).data("value",f).prop("value",f),this.setValue(f,!0),this.element.trigger({type:"slideStop",value:f}).data("value",f).prop("value",f),!1}},mousemove:function(a){if(!this.isEnabled())return!1;this.touchCapable&&"touchmove"===a.type&&(a=a.originalEvent);var b=this.getPercentage(a);this.adjustPercentageForRangeSliders(b),this.percentage[this.dragged]=this.reversed?100-b:b,this.layout();var c=this.calculateValue();return this.setValue(c,!0),!1},adjustPercentageForRangeSliders:function(a){this.range&&(0===this.dragged&&this.percentage[1]<a?(this.percentage[0]=this.percentage[1],this.dragged=1):1===this.dragged&&this.percentage[0]>a&&(this.percentage[1]=this.percentage[0],this.dragged=0))},mouseup:function(){if(!this.isEnabled())return!1;this.touchCapable&&a(document).off({touchmove:this.mousemove,touchend:this.mouseup}),a(document).off({mousemove:this.mousemove,mouseup:this.mouseup}),this.inDrag=!1,this.over===!1&&this.hideTooltip();var b=this.calculateValue();return this.layout(),this.element.data("value",b).prop("value",b).trigger({type:"slideStop",value:b}),!1},calculateValue:function(){var a;return this.range?(a=[this.min,this.max],0!==this.percentage[0]&&(a[0]=Math.max(this.min,this.min+Math.round(this.diff*this.percentage[0]/100/this.step)*this.step),a[0]=this.applyPrecision(a[0])),100!==this.percentage[1]&&(a[1]=Math.min(this.max,this.min+Math.round(this.diff*this.percentage[1]/100/this.step)*this.step),a[1]=this.applyPrecision(a[1])),this.value=a):(a=this.min+Math.round(this.diff*this.percentage[0]/100/this.step)*this.step,a<this.min?a=this.min:a>this.max&&(a=this.max),a=parseFloat(a),a=this.applyPrecision(a),this.value=[a,this.value[1]]),a},applyPrecision:function(a){var b=this.precision||this.getNumDigitsAfterDecimalPlace(this.step);return this.applyToFixedAndParseFloat(a,b)},getNumDigitsAfterDecimalPlace:function(a){var b=(""+a).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);return b?Math.max(0,(b[1]?b[1].length:0)-(b[2]?+b[2]:0)):0},applyToFixedAndParseFloat:function(a,b){var c=a.toFixed(b);return parseFloat(c)},getPercentage:function(a){!this.touchCapable||"touchstart"!==a.type&&"touchmove"!==a.type||(a=a.touches[0]);var b=100*(a[this.mousePos]-this.offset[this.stylePos])/this.size;return b=Math.round(b/this.percentage[2])*this.percentage[2],Math.max(0,Math.min(100,b))},getValue:function(){return this.range?this.value:this.value[0]},setValue:function(a,b){if(a||(a=0),this.value=this.validateInputValue(a),this.range?(this.value[0]=this.applyPrecision(this.value[0]),this.value[1]=this.applyPrecision(this.value[1]),this.value[0]=Math.max(this.min,Math.min(this.max,this.value[0])),this.value[1]=Math.max(this.min,Math.min(this.max,this.value[1]))):(this.value=this.applyPrecision(this.value),this.value=[Math.max(this.min,Math.min(this.max,this.value))],this.handle2.addClass("hide"),this.value[1]="after"===this.selection?this.max:this.min),this.diff=this.max-this.min,this.percentage=this.diff>0?[100*(this.value[0]-this.min)/this.diff,100*(this.value[1]-this.min)/this.diff,100*this.step/this.diff]:[0,0,100],this.layout(),b===!0){var c=this.range?this.value:this.value[0];this.element.trigger({type:"slide",value:c}).data("value",c).prop("value",c)}},validateInputValue:function(b){if("number"==typeof b)return b;if(b instanceof Array)return a.each(b,function(a,b){if("number"!=typeof b)throw new Error(e.formatInvalidInputErrorMsg(b))}),b;throw new Error(e.formatInvalidInputErrorMsg(b))},destroy:function(){this.handle1.off(),this.handle2.off(),this.element.off().show().insertBefore(this.picker),this.picker.off().remove(),a(this.element).removeData("slider")},disable:function(){this.enabled=!1,this.handle1.removeAttr("tabindex"),this.handle2.removeAttr("tabindex"),this.picker.addClass("slider-disabled"),this.element.trigger("slideDisabled")},enable:function(){this.enabled=!0,this.handle1.attr("tabindex",0),this.handle2.attr("tabindex",0),this.picker.removeClass("slider-disabled"),this.element.trigger("slideEnabled")},toggle:function(){this.enabled?this.disable():this.enable()},isEnabled:function(){return this.enabled},setAttribute:function(a,b){this[a]=b},getAttribute:function(a){return this[a]}};var g={getValue:f.prototype.getValue,setValue:f.prototype.setValue,setAttribute:f.prototype.setAttribute,getAttribute:f.prototype.getAttribute,destroy:f.prototype.destroy,disable:f.prototype.disable,enable:f.prototype.enable,toggle:f.prototype.toggle,isEnabled:f.prototype.isEnabled};a.fn.slider=function(a){if("string"==typeof a&&"refresh"!==a){var c=Array.prototype.slice.call(arguments,1);return b.call(this,a,c)}return d.call(this,a)},a.fn.slider.defaults={min:0,max:10,step:1,precision:0,orientation:"horizontal",value:5,range:!1,selection:"before",tooltip:"show",tooltip_separator:":",tooltip_split:!1,natural_arrow_keys:!1,handle:"round",reversed:!1,enabled:!0,formater:function(a){return a}},a.fn.slider.Constructor=f}(window.jQuery);;
(function(a,k){var l={type:"",text:"",top:0,left:0,angle:45,size:50,distance:50,template:'<div class="grumble" style="display:none;filter:progid:DXImageTransform.Microsoft.Matrix(sizingMethod=\'auto expand\')">&#160;</div>',textTemplate:'<div class="grumble-text" style="display:none;"><div class="outer"><div class="inner">{text}</div></div></div>',context:a("body")};k.GrumbleBubble=function(j){this.options=a.extend({},l,j);this.context=a(this.options.context);this.css={};this.create()};k.GrumbleBubble.prototype=
{create:function(){var j=k.GrumbleBubble.prototype.tmpl;this.bubble=a(j(this.options.template));this.text=a(j(this.options.textTemplate,{text:this.options.text}));this.prepare()},setBubbleRotation:function(){this.rotateDeg=this.options.angle-45;this.rotateDeg<0&&(this.rotateDeg+=360)},prepare:function(){var j=this.bubble.get(0).parentNode;this.setBubbleRotation();this.applyStyles();j!==this.context&&this.append();this.rotate()},applyStyles:function(){this.setPosition();this.css.width=this.options.size;
this.css.height=this.options.size;this.text.css(this.css).addClass("grumble-text"+this.options.size);this.bubble.css(this.css).addClass(this.options.type+"grumble"+this.options.size);this.realLeft=this.css.left;this.realTop=this.css.top},setPosition:function(){var j=this.options.angle/-360,a=this.options.size/2,f=this.options.size*this.options.size,f=Math.sqrt(f+f)/2,d=this.options.left-a-Math.sin(j*2*Math.PI)*(this.options.distance+f);this.css.top=this.options.top+a-Math.cos(j*2*Math.PI)*(this.options.distance+
f)-this.options.size;this.css.left=d},append:function(){var a=this.context;this.bubble.appendTo(a);this.text.appendTo(a)},rotate:function(){a.browser.msie===!0?this.ieRotate():this.cssRotate()},cssRotate:function(){this.bubble.css({"-moz-transform":"rotate("+this.rotateDeg+"deg)","-webkit-transform":"rotate("+this.rotateDeg+"deg)","-o-transform":"rotate("+this.rotateDeg+"deg)",transform:"rotate("+this.rotateDeg+"deg)"})},ieRotate:function(){var a=this.rotateDeg*(Math.PI*2/360),h=Math.cos(a),a=Math.sin(a),
f=this.bubble.get(0);f.filters.item(0).M11=h;f.filters.item(0).M12=-a;f.filters.item(0).M21=a;f.filters.item(0).M22=h;h=this.bubble.width();a=this.bubble.height();this.bubble.css({left:this.css.left-(h-this.options.size)/2,top:this.css.top-(a-this.options.size)/2})},adjust:function(j){a.extend(this.options,j);this.prepare()},tmpl:function(a,h,f){for(var d in h)h[d]===null&&(h[d]=""),typeof h[d]==="object"&&h[d].length&&(h[d]=h[d].join(", ")),a=a.replace(RegExp("{"+d+"}","g"),f?escape(h[d]):h[d]);
return a}}})($,window);(function(a,k){function l(a,d){var e,c;d?(c=Number(a.css("margin-top").replace("px",""))||0,e=a.position(),e.top+=c+d.scrollTop()+a.height()):(e=a.offset(),e.top+=a.height());e.left+=a.width()/2;return e}function j(f,d,e){var c=a('<div style="position:absolute;visibility:hidden;width:'+f+'px;">'+e+"</div>").appendTo(a(document.body)),h=c.outerHeight()*2+f*0.2,b=a.inArray(f,d);c.remove();return h>=f&&d[++b]?j(d[b],d,e):f}var h=[];a.fn.grumble=function(f,d){return typeof f==="string"?(this.trigger({type:f+
".bubble",adjustments:d}),this):this.each(function(){var e=a(this),c=a.extend({},a.fn.grumble.defaults,f,e.data("grumble")||{}),d=j(c.size,c.sizeRange,c.text),b,g,i,n,m;c.useRelativePositioning&&(m=e.offsetParent());n=l(e,m);c.top=n.top;c.left=n.left;if(a.data(this,"hazGrumble"))return e.grumble("adjust",f),e.grumble("show"),!0;else a.data(this,"hazGrumble",!0);i={init:function(){b=new k({text:c.text,top:c.top,left:c.left,angle:c.angle,size:d,distance:c.distance,type:c.type,context:m});c.hasHideButton&&
this.addButton();h.push({grumble:b,button:g,onHide:function(){i.isVisible=!1;a(document.body).unbind("click.bubble");i.doOnBeginHideCallback();i.doOnHideCallback()}});this.showBubble();this.prepareEvents()},addButton:function(){var o=k.prototype.tmpl;g=a(o(c.buttonTemplate,{hideText:c.buttonHideText})).css({left:b.realLeft+d-10,top:b.realTop+d-10}).insertAfter(b.text)},rePositionButton:function(){g&&g.css({left:b.realLeft+d-10,top:b.realTop+d-10})},createFxQueue:function(){b.bubble.queue("fx");b.text.queue("fx");
b.bubble.delay(c.showAfter);b.text.delay(c.showAfter);g&&g.delay(c.showAfter)},showBubble:function(){i.isVisible!=!0&&(c.showAfter&&i.createFxQueue(),a.browser.msie===!0?(b.bubble.queue("fx",function(a){b.bubble.show();a()}),b.text.queue("fx",function(a){b.text.show();a()}),g&&g.queue("fx",function(a){g.show();a()})):(b.bubble.fadeTo("fast",1),b.text.fadeTo("fast",1),g&&g.fadeTo("fast",1)),b.bubble.queue("fx",function(a){i.isVisible=!0;(c.hideOnClick||c.hasHideButton)&&i.hideOnClick();i.doOnShowCallback();
a()}),c.hideAfter&&i.hideBubble())},hideBubble:function(){b.bubble.delay(c.hideAfter);b.text.delay(c.hideAfter);b.bubble.queue("fx",function(a){i.doOnBeginHideCallback();a()});a.browser.msie===!0?(b.bubble.queue("fx",function(a){b.bubble.hide();a()}),b.bubble.queue("fx",function(a){b.text.hide();a()}),g&&g.queue("fx",function(a){g.hide();a()})):(b.bubble.fadeOut(),b.text.fadeOut(),g&&g.fadeOut());b.bubble.queue("fx",function(a){i.isVisible=!1;i.doOnHideCallback();a()})},doOnBeginHideCallback:function(){c.onBeginHide(b,
g)},doOnHideCallback:function(){c.onHide(b,g)},doOnShowCallback:function(){c.onShow(b,g)},hideOnClick:function(){setTimeout(function(){var c=function(){i.hideBubble(b,g);a(document.body).unbind("click.bubble",c)};a(document.body).bind("click.bubble",c)},1E3)},prepareEvents:function(){a(window).bind("resize.bubble",function(){var a;a=l(e,m);b.adjust({top:a.top,left:a.left});i.rePositionButton()});e.bind("hide.bubble",function(){i.hideBubble(b,g)});e.bind("adjust.bubble",function(a){a.adjustments&&
typeof a.adjustments==="object"&&b.adjust(a.adjustments)});e.bind("show.bubble",function(){i.showBubble(b,g)});e.bind("delete.bubble",function(){b.bubble.hide().remove();b.text.hide().remove();g&&g.hide().remove();for(var a=h.length,c=0;c<a;c++)if(b===h[c].grumble){h.splice(c,1);break}e.removeData("hazGrumble")})}};i.init()})};a.fn.grumble.defaults={text:"",angle:45,size:50,sizeRange:[50,100,150,200],distance:0,type:"",useRelativePositioning:!1,showAfter:0,hideAfter:!1,hideOnClick:!1,hasHideButton:!1,
buttonTemplate:'<div class="grumble-button" style="display:none" title="{hideText}">x</div>',buttonHideText:"Hide",onHide:function(){},onShow:function(){},onBeginHide:function(){}};a(document).bind("keyup.bubble",function(f){f.keyCode===27&&a.each(h,function(a,e){e.grumble.bubble.clearQueue().hide();e.grumble.text.clearQueue().hide();e.button&&e.button.clearQueue().hide();e.onHide()})})})(jQuery,GrumbleBubble);
;
(function($){var Crumble=function(){var position=0;var setup=[];var $setup;var defaults={grumble:{text:'',angle:85,distance:30,showAfter:0,hasHideButton:false},scrollSpeed:'fast',onStep:function(){},onStart:function(){},onFinish:function(){}};var scrollToGrumble=function($grumble){var top=$grumble.position().top;var bottom=$grumble.height()+top;var windowHeight=$(window).innerHeight();var windowTop=$(window).scrollTop();var windowBottom=windowHeight+windowTop;var pad=100;if(top<windowTop){$('html, body').animate({scrollTop:top-pad},defaults.scrollSpeed)}else if(bottom>windowBottom){$('html, body').animate({scrollTop:bottom-windowHeight+pad},defaults.scrollSpeed)}};var getCurrentGrumble=function(){return $('.grumble').last().next()};var calculateAngle=function($element){var windowTop=$(window).scrollTop();var centerX=window.innerWidth/2;var centerY=window.innerHeight/2;var elementX=$element.position().left;var elementY=$element.position().top+windowTop;var o=elementY-centerY;var a=elementX-centerX;var angle=Math.atan2(o,a)*(180/Math.PI);if(angle<0)return angle-90;return angle+90};var bindKeys=function(){$(document).bind('keyup.crumble',function(ev){if(ev.keyCode===27){ev.stopImmediatePropagation();methods.clear();$(document).unbind('keyup.crumble')}})};var methods={init:function(o){defaults=$.extend(defaults,o);$('li',this).each(function(index,stop){var $stop=$(stop);var opt=$stop.data('options');var options={};options.text=$stop.html();options.angle=$stop.data('angle');if(opt){var j;var data=opt.split(';');for(var i in data){j=data[i].split(':');if(j.length===2){options[j[0]]=j[1]}else{continue}}}setup.push({target:$stop.data('target'),options:options})});methods.clear();methods.step();bindKeys();return this},go:function(pos){position=Math.max(0,Math.min(pos,setup.length-1));this.step()},forward:function(){position++;methods.step();defaults.onStep(position,setup[position])},step:function(){if(position===0){defaults.onStart()}if(position>=setup.length){methods.clear();defaults.onFinish();return}var current=setup[position];var $current=$(current.target).first();if(!current.target){$.error('Crumble step does not include data-target property');return}if(!$current.length){methods.forward();return}var options=$.extend({},defaults.grumble,current.options,{angle:current.options.angle||calculateAngle($current),onHide:function(){methods.forward()},onShow:function(){var $grumble=getCurrentGrumble();scrollToGrumble($grumble);$grumble.data('clicked',false);$grumble.click(function(ev){ev.stopImmediatePropagation();if(!$grumble.data('clicked')){$grumble.data('clicked',true);$current.trigger('hide.bubble')}});$grumble.hover(function(){$grumble.prev().addClass('hover')},function(){$grumble.prev().removeClass('hover')})}});options.distance=parseInt(options.distance,10);$current.grumble(options)},clear:function(){position=0;$('.grumble, .grumble-text, .grumble-button').remove()}};return methods};$.fn.crumble=function(method){var args=arguments;return this.each(function(){var state=$(this).data('Crumble');if(state&&state[method]){state[method].apply(this,Array.prototype.slice.call(args,1))}else if(typeof method==='object'||!method){var tr=(new Crumble(this));tr.init.apply(this,args);$(this).data('Crumble',tr)}else{$.error('Method '+method+' does not exist on jQuery.crumble')}})}})(jQuery);;
//facebook
(function(d, s, id) {
var js, fjs = d.getElementsByTagName(s)[0];
if (d.getElementById(id)) return;
js = d.createElement(s); js.id = id;
js.src = "//connect.facebook.net/it_IT/sdk.js#xfbml=1&appId=455565641219872&version=v2.0";
fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));
//google+1
(function() {
var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
po.src = 'https://apis.google.com/js/plusone.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
})();
//twitter
!function(d,s,id){
var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}
}(document, 'script', 'twitter-wjs');;
$(function(){function a(a){if(h){l.clearLayers(),i=0,layer=h.getLayers()[0];var b=layer.toGeoJSON();b.geometry.coordinates=simplifyGeometry(b.geometry.coordinates,a),l.addData(b),k=b,i+=b.geometry.coordinates.length,g.text(i)}}function b(){try{if(new Blob){var a=togpx(k),b=new Blob([a],{type:"text/plain;charset=utf-8"});saveAs(b,j+"_"+i+"nodes.gpx")}}catch(c){return alert("For download gpx file using Chrome or Firefox"),!1}}var c=new L.Map("map",{attributionControl:!1}).setView(L.latLng(36,-30),3),d={color:"red",opacity:.7,fillOpacity:.7,weight:6,clickable:!1},e={color:"blue",opacity:1,fillOpacity:1,weight:2,clickable:!1};L.tileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(c);var f,g,h=null,i=0,j="simplified.gpx",k=null,l=L.geoJson(k,{style:e}).addTo(c);L.Control.FileLayerLoad.LABEL='<i class="fa fa-folder-open"></i>';var m=L.Control.fileLayerLoad({addToMap:!0,fitBounds:!1,fileSizeLimit:8096,layerOptions:{style:d,pointToLayer:function(a,b){return L.circle(b,10,{style:d})}}}).addTo(c);m.loader.on("data:loaded",function(b){h=b.layer,c.fitBounds(h.getBounds()),j=b.filename,a(0),f.html(j),$(".grumble, .grumble-text, .grumble-button").remove(),$(document).unbind("keyup.crumble")}).on("data:error",function(a){console.log("ERROR",a)}),function(){var a=new L.Control({position:"topleft"});return a.onAdd=function(){var a=L.DomUtil.create("div","leaflet-control-down leaflet-bar"),c=L.DomUtil.create("a","",a);return c.href="#",c.target="_blank",c.title="Download simplified GPX file",c.innerHTML='<i class="fa fa-download"></i>',L.DomEvent.on(c,"click",L.DomEvent.stop).on(c,"click",b),a},a}().addTo(c),function(){var b=new L.Control({position:"bottomleft"});return b.onAdd=function(b){var c=L.DomUtil.create("div","leaflet-control-slider"),d=L.DomUtil.create("input","input-slider",c);d.type="text";var e=$(d).slider({value:0,min:0,max:.002,step:1e-4,precision:8,tooltip:"hide"}).on("slide",function(b){b.preventDefault(),b.stopPropagation(),a(b.value)}).on("slideStart",function(a){a.preventDefault(),a.stopPropagation()});return L.DomEvent.disableClickPropagation(c),e.parent().width(b.getSize().x-40),b.on("resize",function(a){e.parent().width(a.newSize.x-40)}),c},b}().addTo(c),function(){var a=new L.Control({position:"bottomleft"});return a.onAdd=function(){var a=L.DomUtil.create("div","leaflet-control-stats");return a.id="stats",a.innerHTML='<span id="nodes"></span> nodes<br /><span id="filename"></span>',f=$("#filename",a),g=$("#nodes",a),a},a}().addTo(c),L.control.sidebar("sidebar",{position:"right",autoPan:!1}).addTo(c).show(),L.control.attribution({position:"topright",prefix:'<a href="http://leafletjs.com/">Leaflet</a> &bull; <a href="http://osm.org/" target="_blank">OpenStreetMap contributors</a>'}).addTo(c),$.cookie("tour")||$("#tour").crumble({grumble:{showAfter:200,distance:20},onStep:function(){$.cookie("tour","1",{expires:120})}})});