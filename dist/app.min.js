//facebook
(function(d, s, id) {
var js, fjs = d.getElementsByTagName(s)[0];
if (d.getElementById(id)) return;
js = d.createElement(s); js.id = id;
js.src = "//connect.facebook.net/it_IT/sdk.js#xfbml=1&appId=455565641219872&version=v2.0";
fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));
//google+1
(function() {
var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
po.src = 'https://apis.google.com/js/plusone.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
})();
//twitter
!function(d,s,id){
var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}
}(document, 'script', 'twitter-wjs');;
function filesizeHuman(a,b){if(0===a)return a;b=b||1;var c=["Bytes","KB","MB","GB","TB"],d=parseInt(Math.floor(Math.log(a)/Math.log(1024)));return(a/Math.pow(1024,d)).toFixed(b)+" "+c[d]}function nodes2Bytes(a){return filesizeHuman(400+56*a)}function getPosition(a){for(var b=0,c=0;a;)b+=a.offsetLeft-a.scrollLeft+a.clientLeft,c+=a.offsetTop-a.scrollTop+a.clientTop,a=a.offsetParent;return{x:b,y:c}}function hideAll(){$(".popup").each(function(){$(this).hide()})}function chooseDownloadFormat(a){hideAll();var b=getPosition(a.currentTarget);$("#download-formats").css("top",b.y-4),$("#download-formats").show()}function chooseViewFormat(a){hideAll();var b=getPosition(a.currentTarget);$("#view-formats").css("top",b.y-4),$("#view-formats").show(),$("#download-formats").hide()}function GeoJSONFormat(){this.param={key:"geojson",syntax:"json",name:"GeoJSON",extension:"geojson",contenttype:"appplication/json"},this.exportData=function(a){return JSON.stringify(a)},this.display=function(a){return prettyData.json(a)}}function GPXFormat(){this.param={key:"gpx",syntax:"xml",name:"GPX",extension:"gpx",contenttype:"application/gpx+xml"},this.exportData=function(a){return togpx(a)},this.display=function(a){return prettyData.xml(a)}}function KMLFormat(){this.param={key:"kml",syntax:"xml",name:"KML",extension:"kml",contenttype:"application/vnd.google-earth.kml+xml"},this.exportData=function(a){return tokml(a)},this.display=function(a){return prettyData.xml(a)}}function MediawikiFormat(){this.param={key:"mediawiki",syntax:"nohighlight",name:"Mediawiki",extension:"txt",contenttype:"text/plain"},this.exportData=function(a){return geojsonToPath(a)}}$("#export-close").on("click",function(){$("#export-format").hide()});var Format=function(){this.param={key:"format",name:"RootFormat"}};Format.prototype={loadAll:function(a){a.forEach(function(a){f=new window[a],f.load()})},load:function(){var a=document.createElement("a"),b=document.createTextNode("View in "+this.param.name);a.appendChild(b),a.title="View the simplified data in "+this.param.name,a.className="view",$(a).on("click",this.viewClick.bind(this)),$("#view-formats").append(a),a=document.createElement("a"),b=document.createTextNode("Download in "+this.param.name),a.appendChild(b),a.title="Download the simplified data in "+this.param.name,a.className="download",$(a).on("click",this.saveClick.bind(this)),$("#download-formats").append(a)},display:function(a){return a},save:function(a){name=a.name.replace(/\..*/,""),name=name+"_"+a.simplifiedLayerNodes+"nodes."+this.param.extension;try{if(new Blob){var b=this.exportData(a.simplifiedLayerData),c=new Blob([b],{type:this.param.contenttype+";charset=utf-8"});saveAs(c,name)}}catch(d){alert("Please upload GPX/GeoJSON/KML file first, using Chrome or Firefox: "+d.message),console.log(d.message)}hideAll()},saveClick:function(){this.save(window.currentLayer)},view:function(a){try{if(new Blob){var b=this.exportData(a.simplifiedLayerData);b=this.display(b),$("code").attr("class",this.param.syntax),$("#export-content").text(b),a.simplifiedLayerNodes<1e3&&$("code").each(function(a,b){hljs.highlightBlock(b)}),$("#export-format h5").html("Simplified geometry in "+this.param.name+" format"),$("#export-format").show()}}catch(c){alert("Please upload GPX/GeoJSON/KML file first, using Chrome or Firefox: "+c.message),console.log(c.message)}hideAll()},viewClick:function(){this.view(window.currentLayer)}},GeoJSONFormat.prototype=new Format,GPXFormat.prototype=new Format,KMLFormat.prototype=new Format,MediawikiFormat.prototype=new Format;;
function updateLayers(){$(".leaflet-control-switcher").html("");for(var a in window.Layers){var b=window.Layers[a];$(".leaflet-control-switcher").append('<option value="'+b.id+'" '+(window.currentLayer.name==b.name?' selected="selected"':"")+">"+b.name+"</option>")}Object.keys(window.Layers).length>0?$(".leaflet-control-switcher-box").show():$(".leaflet-control-switcher-box").hide()}function clearMap(){for(var a in window.Layers)window.Layers[a].remove();window.Layers={},updateLayers()}window.style1={color:"red",opacity:.7,fillOpacity:.7,weight:5,clickable:!1},window.style2={color:"blue",opacity:1,fillOpacity:1,weight:2,clickable:!1};var LayerOptimizer=function(a){this.id=this.createId(),this.name=a.filename,this.sourceLayer=a.layer,this.sourceLayerStyle=window.style1,this.sourceLayerData=this.getSourceData(),this.sourceLayerNodes=this.sourceLayerData.geometry.coordinates.length,this.simplifiedLayerStyle=window.style2,this.simplifiedLayer=L.geoJson(null,{style:this.simplifiedLayerStyle}).addTo(window.map),this.simplifiedLayerNodes=0,this.controller=null};LayerOptimizer.prototype={getSourceData:function(){return this.sourceLayer.getLayers()[0].toGeoJSON()},choose:function(){this.zoom(),this.createLayerGroup(),this.displayInfos()},optimize:function(a){this.simplifiedLayer.clearLayers(),this.simplifiedLayerData=this.getSourceData(),this.simplifiedLayerData.geometry.coordinates=simplifyGeometry(this.simplifiedLayerData.geometry.coordinates,a),this.simplifiedLayer.addData(this.simplifiedLayerData),this.simplifiedLayerNodes=this.simplifiedLayerData.geometry.coordinates.length},getBounds:function(){return this.sourceLayer.getBounds()},zoom:function(){window.map.fitBounds(this.getBounds())},createLayerGroup:function(){var a={};a[this.name+" (simplified)"]=this.simplifiedLayer,a[this.name+" (source)"]=this.sourceLayer,this.controller=L.control.layers(null,a),this.controller.addTo(window.map)},displayInfos:function(){var a="Optimize : "+this.name,b="From "+this.sourceLayerNodes+" nodes to "+this.simplifiedLayerNodes+" nodes";$("#filename").html(a),$("#nodes").html(b)},remove:function(){this.removeLayers(),this.removeController()},removeLayers:function(){try{window.map.removeLayer(this.simplifiedLayer),window.map.removeLayer(this.sourceLayer)}catch(a){console.log("Layers not found, probably already removed")}},removeController:function(){try{void 0!==this.controller._map&&this.controller.removeFrom(window.map)}catch(a){console.log("Controller not found, probably already removed")}},createId:function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return a()+a()+a()+a()}};;
$(function(){var a=new L.Map("map",{attributionControl:!1}).setView(L.latLng(36,-30),3);window.map=a,L.tileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(a),window.Layers={},window.currentLayer=null,L.Control.FileLayerLoad.LABEL='<i class="fa fa-folder-open"></i>';var b=L.Control.fileLayerLoad({addToMap:!0,fitBounds:!1,fileSizeLimit:8096,layerOptions:{style:style1,pointToLayer:function(a,b){return L.circle(b,10,{style:style1})}}}).addTo(a);b.loader.on("data:loaded",function(a){window.currentLayer&&window.currentLayer.removeController();var b=new LayerOptimizer(a);b.optimize(0),b.choose(),window.Layers[b.id]=b,window.currentLayer=b,updateLayers()}).on("data:error",function(a){console.log("ERROR",a)}),function(){var a=new L.Control({position:"topleft"});return a.onAdd=function(a){var b=L.DomUtil.create("div","leaflet-control-download leaflet-bar"),c=L.DomUtil.create("a","",b);return c.href="#",c.target="_blank",c.title="Download simplified file",c.innerHTML='<i class="fa fa-download"></i>',L.DomEvent.on(c,"click",L.DomEvent.stop).on(c,"click",chooseDownloadFormat),b},a}().addTo(a),function(){var a=new L.Control({position:"topleft"});return a.onAdd=function(a){var b=L.DomUtil.create("div","leaflet-control-view leaflet-bar"),c=L.DomUtil.create("a","",b);return c.href="#",c.target="_blank",c.title="View simplified file",c.innerHTML='<i class="fa fa-eye"></i>',L.DomEvent.on(c,"click",L.DomEvent.stop).on(c,"click",chooseViewFormat),b},a}().addTo(a),function(){var a=new L.Control({position:"topleft"});return a.onAdd=function(a){var b=L.DomUtil.create("div","leaflet-control-erase leaflet-bar"),c=L.DomUtil.create("a","",b);return c.href="#",c.target="_blank",c.title="Clear the map",c.innerHTML='<i class="fa fa-eraser"></i>',L.DomEvent.on(c,"click",L.DomEvent.stop).on(c,"click",clearMap),b},a}().addTo(a),function(){var a=new L.Control({position:"bottomleft"});return a.onAdd=function(a){var b=L.DomUtil.create("div","leaflet-control-stats");return b.id="stats",b.innerHTML='<span id="nodes"></span><br /><span id="filename"></span>',filename$=$("#filename",b),nodes$=$("#nodes",b),b},a}().addTo(a),L.control.attribution({position:"topright",prefix:'<a href="http://leafletjs.com/">Leaflet</a> &bull; <a href="http://osm.org/" target="_blank">OpenStreetMap contributors</a>'}).addTo(a),function(){var a=new L.Control({position:"topright"});return a.onAdd=function(a){var b=L.DomUtil.create("div","leaflet-control-switcher-box leaflet-bar"),c=L.DomUtil.create("label","",b);c.href="#",c.title="Choose the active layer",c.innerHTML="Layer switcher";var d=L.DomUtil.create("select","leaflet-control-switcher leaflet-bar",b);return L.DomEvent.on(d,"change",function(){window.currentLayer.removeController(),window.currentLayer=window.Layers[$(this).val()],window.currentLayer.choose()}),b},a}().addTo(a),$("#slider").slider({value:0,min:0,max:.1,step:5e-5,precision:8,tooltip:"hide"}).on("slide",function(a){window.currentLayer.optimize(a.value),window.currentLayer.displayInfos()}).parent().width("100%"),$("#helpbtn").on("click",function(a){a.preventDefault(),$("#modal").modal("show")});var c=$.cookie("tour");(!c||parseInt(c)<3)&&($("#modal").modal("show"),c=(parseInt(c)||0)+1,$.cookie("tour",c,{expires:120}));var d=new Format;d.loadAll(["GeoJSONFormat","GPXFormat","KMLFormat","MediawikiFormat"]),hljs.initHighlightingOnLoad()});