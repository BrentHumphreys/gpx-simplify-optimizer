$(function(){function a(a){if(g){window.simplifyLayer.clearLayers(),window.simplifyNodes=0,layer=g.getLayers()[0];var b=layer.toGeoJSON();b.geometry.coordinates=simplifyGeometry(b.geometry.coordinates,a),window.simplifyLayer.addData(b),window.simplifyLayerData=b,window.simplifyNodes+=b.geometry.coordinates.length,f.text(window.simplifyNodes+" nodes ~"+nodes2Bytes(window.simplifyNodes))}}var b=new L.Map("map",{attributionControl:!1}).setView(L.latLng(36,-30),3),c={color:"red",opacity:.7,fillOpacity:.7,weight:5,clickable:!1},d={color:"blue",opacity:1,fillOpacity:1,weight:2,clickable:!1};window.map=b,window.style2=d,L.tileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(b);var e,f,g=null;window.simplifyNodes=0,window.simplifyLayerName="simplified.gpx",window.simplifyLayerData=null,window.simplifyLayer=L.geoJson(window.simplifyLayerData,{style:d}).addTo(b),L.Control.FileLayerLoad.LABEL='<i class="fa fa-folder-open"></i>';var h=L.Control.fileLayerLoad({addToMap:!0,fitBounds:!1,fileSizeLimit:8096,layerOptions:{style:c,pointToLayer:function(a,b){return L.circle(b,10,{style:c})}}}).addTo(b);(function(){var a=new L.Control({position:"topleft"});return a.onAdd=function(){var a=L.DomUtil.create("div","leaflet-control-planes leaflet-bar"),b=L.DomUtil.create("a","",a);return b.href="#",b.target="_blank",b.title="Download simplified file",b.innerHTML='<i class="fa icon-plane"></i>',L.DomEvent.on(b,"click",L.DomEvent.stop).on(b,"click",chooseAirports),a},a})().addTo(b),h.loader.on("data:loaded",function(c){g=c.layer,b.fitBounds(g.getBounds()),window.simplifyLayerName=c.filename,a(0),e.html(window.simplifyLayerName),$(".grumble, .grumble-text, .grumble-button").remove(),$(document).unbind("keyup.crumble")}).on("data:error",function(a){console.log("ERROR",a)}),function(){var a=new L.Control({position:"topleft"});return a.onAdd=function(){var a=L.DomUtil.create("div","leaflet-control-download leaflet-bar"),b=L.DomUtil.create("a","",a);return b.href="#",b.target="_blank",b.title="Download simplified file",b.innerHTML='<i class="fa fa-download"></i>',L.DomEvent.on(b,"click",L.DomEvent.stop).on(b,"click",chooseDownloadFormat),a},a}().addTo(b),function(){var a=new L.Control({position:"topleft"});return a.onAdd=function(){var a=L.DomUtil.create("div","leaflet-control-view leaflet-bar"),b=L.DomUtil.create("a","",a);return b.href="#",b.target="_blank",b.title="View simplified file",b.innerHTML='<i class="fa fa-eye"></i>',L.DomEvent.on(b,"click",L.DomEvent.stop).on(b,"click",chooseViewFormat),a},a}().addTo(b),function(){var a=new L.Control({position:"topleft"});return a.onAdd=function(a){var b=L.DomUtil.create("div","leaflet-control-erase leaflet-bar"),c=L.DomUtil.create("a","",b);return c.href="#",c.target="_blank",c.title="Clear the map",c.innerHTML='<i class="fa fa-eraser"></i>',L.DomEvent.on(c,"click",L.DomEvent.stop).on(c,"click",function(){g.eachLayer(function(b){a.removeLayer(b)}),simplifyLayer.clearLayers()}),b},a}().addTo(b),function(){var a=new L.Control({position:"bottomleft"});return a.onAdd=function(){var a=L.DomUtil.create("div","leaflet-control-stats");return a.id="stats",a.innerHTML='<span id="nodes"></span><br /><span id="filename"></span>',e=$("#filename",a),f=$("#nodes",a),a},a}().addTo(b),L.control.attribution({position:"topright",prefix:'<a href="http://leafletjs.com/">Leaflet</a> &bull; <a href="http://osm.org/" target="_blank">OpenStreetMap contributors</a>'}).addTo(b),$("#slider").slider({value:0,min:0,max:.1,step:5e-5,precision:8,tooltip:"hide"}).on("slide",function(b){a(b.value)}).parent().width("100%"),$("#helpbtn").on("click",function(){$("#modal").modal("show")});var i=new Format;i.loadAll(["GeoJSONFormat","GPXFormat","KMLFormat","MediawikiFormat"]),hljs.initHighlightingOnLoad()});