$(function(){function a(a){if(h){l.clearLayers(),i=0,layer=h.getLayers()[0];var b=layer.toGeoJSON();b.geometry.coordinates=simplifyGeometry(b.geometry.coordinates,a),l.addData(b),k=b,i+=b.geometry.coordinates.length,g.text(i)}}function b(){try{if(new Blob){var a=togpx(k),b=new Blob([a],{type:"text/plain;charset=utf-8"});saveAs(b,j+"_"+i+"nodes.gpx")}}catch(c){return alert("For download gpx file using Chrome or Firefox"),!1}}var c=new L.Map("map",{attributionControl:!1}).setView(L.latLng(36,-30),3),d={color:"red",opacity:.7,fillOpacity:.7,weight:5,clickable:!1},e={color:"blue",opacity:1,fillOpacity:1,weight:2,clickable:!1};L.tileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(c);var f,g,h=null,i=0,j="simplified.gpx",k=null,l=L.geoJson(k,{style:e}).addTo(c);L.Control.FileLayerLoad.LABEL='<i class="fa fa-folder-open"></i>';var m=L.Control.fileLayerLoad({addToMap:!0,fitBounds:!1,fileSizeLimit:8096,layerOptions:{style:d,pointToLayer:function(a,b){return L.circle(b,10,{style:d})}}}).addTo(c);m.loader.on("data:loaded",function(b){h=b.layer,c.fitBounds(h.getBounds()),j=b.filename,a(0),f.html(j),$(".grumble, .grumble-text, .grumble-button").remove(),$(document).unbind("keyup.crumble")}).on("data:error",function(a){console.log("ERROR",a)}),function(){var a=new L.Control({position:"topleft"});return a.onAdd=function(){var a=L.DomUtil.create("div","leaflet-control-down leaflet-bar"),c=L.DomUtil.create("a","",a);return c.href="#",c.target="_blank",c.title="Download simplified GPX file",c.innerHTML='<i class="fa fa-download"></i>',L.DomEvent.on(c,"click",L.DomEvent.stop).on(c,"click",b),a},a}().addTo(c),function(){var b=new L.Control({position:"bottomleft"});return b.onAdd=function(b){var c=L.DomUtil.create("div","leaflet-control-slider"),d=L.DomUtil.create("input","input-slider",c);d.type="text";var e=$(d).slider({value:0,min:0,max:.002,step:5e-5,precision:8,tooltip:"hide"}).on("slide",function(b){b.preventDefault(),b.stopPropagation(),a(b.value)}).on("slideStart",function(a){a.preventDefault(),a.stopPropagation()});return L.DomEvent.disableClickPropagation(c),e.parent().width(b.getSize().x-40),b.on("resize",function(a){e.parent().width(a.newSize.x-40)}),c},b}().addTo(c),function(){var a=new L.Control({position:"bottomleft"});return a.onAdd=function(){var a=L.DomUtil.create("div","leaflet-control-stats");return a.id="stats",a.innerHTML='<span id="nodes"></span> nodes<br /><span id="filename"></span>',f=$("#filename",a),g=$("#nodes",a),a},a}().addTo(c),L.control.sidebar("sidebar",{position:"right",autoPan:!1}).addTo(c).show(),L.control.attribution({position:"topright",prefix:'<a href="http://leafletjs.com/">Leaflet</a> &bull; <a href="http://osm.org/" target="_blank">OpenStreetMap contributors</a>'}).addTo(c),$("#helpbtn").on("click",function(){$("#modal").modal("show")});var n=$.cookie("tour");(!n||parseInt(n)<3)&&($("#modal").modal("show"),n=(parseInt(n)||0)+1,$.cookie("tour",n,{expires:120}))});