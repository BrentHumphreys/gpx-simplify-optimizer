$(function(){function a(a,b){if(0===a)return a;b=b||1;var c=["Bytes","KB","MB","GB","TB"],d=parseInt(Math.floor(Math.log(a)/Math.log(1024)));return Math.round(a/Math.pow(1024,d),b)+" "+c[d]}function b(b){return a(400+56*b)}function c(a){if(w){A.clearLayers(),x=0,layer=w.getLayers()[0];var c=layer.toGeoJSON();c.geometry.coordinates=simplifyGeometry(c.geometry.coordinates,a),A.addData(c),z=c,x+=c.geometry.coordinates.length,v.text(x+" nodes ~"+b(x))}}function d(){$("#download-formats").show(),$("#view-formats").hide()}function e(){$("#view-formats").show(),$("#download-formats").hide()}function f(){$("#download-formats").hide(),$("#view-formats").hide()}function g(){return togpx(z)}function h(){return JSON.stringify(z)}function i(){return geojsonToPath(z)}function j(a,b,c){try{if(new Blob){var d=(g(),new Blob([a],{type:b+";charset=utf-8"}));name=y.replace(/\..*/,""),saveAs(d,name+"_"+x+"nodes."+c)}}catch(e){return alert("Please upload GPX/GeoJSON/KML file first, using Chrome or Firefox"),!1}f()}function k(){j(h(),"application/json","json")}function l(){j(g(),"text/plain","gpx")}function m(){j(i(),"text/plain","txt")}function n(a){try{new Blob&&($("#export-content").val(a),$("#export-format").show())}catch(b){return alert("Please upload GPX/GeoJSON/KML file first, using Chrome or Firefox"),!1}f()}function o(){n(i())}function p(){n(g())}function q(){n(h())}var r=new L.Map("map",{attributionControl:!1}).setView(L.latLng(36,-30),3),s={color:"red",opacity:.7,fillOpacity:.7,weight:5,clickable:!1},t={color:"blue",opacity:1,fillOpacity:1,weight:2,clickable:!1};L.tileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(r);var u,v,w=null,x=0,y="simplified.gpx",z=null,A=L.geoJson(z,{style:t}).addTo(r);L.Control.FileLayerLoad.LABEL='<i class="fa fa-folder-open"></i>';var B=L.Control.fileLayerLoad({addToMap:!0,fitBounds:!1,fileSizeLimit:8096,layerOptions:{style:s,pointToLayer:function(a,b){return L.circle(b,10,{style:s})}}}).addTo(r);$(".download-geojson").on("click",k),$(".download-gpx").on("click",l),$(".download-path").on("click",m),$(".view-geojson").on("click",q),$(".view-gpx").on("click",p),$(".view-path").on("click",o),$("#export-close").on("click",function(){$("#export-format").hide()}),B.loader.on("data:loaded",function(a){w=a.layer,r.fitBounds(w.getBounds()),y=a.filename,c(0),u.html(y),$(".grumble, .grumble-text, .grumble-button").remove(),$(document).unbind("keyup.crumble")}).on("data:error",function(a){console.log("ERROR",a)}),function(){var a=new L.Control({position:"topleft"});return a.onAdd=function(){var a=L.DomUtil.create("div","leaflet-control-down leaflet-bar"),b=L.DomUtil.create("a","",a);return b.href="#",b.target="_blank",b.title="Download simplified file",b.innerHTML='<i class="fa fa-download"></i>',L.DomEvent.on(b,"click",L.DomEvent.stop).on(b,"click",d),a},a}().addTo(r),function(){var a=new L.Control({position:"topleft"});return a.onAdd=function(){var a=L.DomUtil.create("div","leaflet-control-path leaflet-bar"),b=L.DomUtil.create("a","",a);return b.href="#",b.target="_blank",b.title="View simplified file",b.innerHTML='<i class="fa fa-eye"></i>',L.DomEvent.on(b,"click",L.DomEvent.stop).on(b,"click",e),a},a}().addTo(r),function(){var a=new L.Control({position:"bottomleft"});return a.onAdd=function(){var a=L.DomUtil.create("div","leaflet-control-stats");return a.id="stats",a.innerHTML='<span id="nodes"></span><br /><span id="filename"></span>',u=$("#filename",a),v=$("#nodes",a),a},a}().addTo(r),L.control.attribution({position:"topright",prefix:'<a href="http://leafletjs.com/">Leaflet</a> &bull; <a href="http://osm.org/" target="_blank">OpenStreetMap contributors</a>'}).addTo(r),$("#slider").slider({value:0,min:0,max:.1,step:5e-5,precision:8,tooltip:"hide"}).on("slide",function(a){c(a.value)}).parent().width("100%"),$("#helpbtn").on("click",function(){$("#modal").modal("show")})});